# **アーキテクチャ設計：Next.js 15、Supabase、Netlify**

## **個人アーティストサイト向けアーキテクチャ概要**

個人アーティスト一人のためのオンライン作品展示・販売サイトとして、シンプルさと美しさを両立する設計を採用します。訪問者は会員登録不要で作品を閲覧・購入でき、アーティスト自身が簡単に管理できる構造を目指します。

## **Next.js 15での開発：最新機能の活用**

### **Next.js 15の新機能と対応**

最新のNext.js 15とReact 19の組み合わせにより、以下の改善を実現：

**非同期化されたAPI**
- `params`, `searchParams`: Promise化により`await`が必要
- `headers()`, `cookies()`, `draftMode()`: Promise化により`await`が必要

**キャッシュ動作の変更**
- Route HandlersのGETメソッド: デフォルトでキャッシュされなくなった
- 必要に応じて`export const dynamic = 'force-static'`で制御

### **個人アーティストサイトに特化したNext.js 15活用**

- **ランディングページ**: 代表作品を美しく表示するSSG
- **ギャラリー**: 作品一覧の高速表示とSEO最適化
- **作品詳細**: 動的ルート (`/artwork/[slug]`) で個別作品ページ
- **物語ページ**: アーティストの制作背景を伝える静的コンテンツ
- **管理機能**: APIルートによるCMS機能（作品・注文管理）

アート作品サイトでは、画像の読み込み速度と視覚的インパクトが成功の鍵となります。Next.js 15の`next/image`コンポーネントとNetlify Image CDNの組み合わせにより、訪問者に美術館のような鑑賞体験を提供できます。

## **Supabase：バックエンドの強力な基盤**

### **プロジェクトの初期化と無料利用枠の利点**

Supabaseでの新規プロジェクト作成は簡単です。無料利用枠は非常に寛大で、500MBのデータベース、1GBのファイルストレージ、無制限のAPIリクエスト、月間5万人のアクティブユーザーをサポートします。これは個人のアートストアが開始し、成長するのに十分すぎる容量です。SupabaseはPostgreSQL上に構築されたオープンソースのFirebase代替であり、堅牢なデータベース機能を提供します。

### **個人アーティスト向けデータベース設計**

個人アーティスト一人のサイトに最適化されたシンプルな設計を採用します：

#### **主要テーブル**

**artist_profile テーブル（単一レコード）**
- アーティストの基本情報（名前、経歴、連絡先）
- プロフィール画像、SNSリンク等

**artworks テーブル**
- 作品情報とメタデータ
- `slug`フィールドでSEOフレンドリーなURL
- `story`フィールドで制作背景を保存
- `category`での作品分類（絵画、素描、版画等）

**orders テーブル**
- 顧客情報を直接格納（会員登録不要のため）
- Stripe決済との連携情報

**page_contents テーブル**
- About、Storyページ等の動的コンテンツ管理
- Markdown形式での柔軟なコンテンツ編集

この設計により、複雑なユーザー管理を避けながら、必要な機能をすべて実現できます。

### **シンプルな認証設計**

個人アーティストサイトとして、複雑な認証システムは不要です：

**管理者アクセス**
- 環境変数で指定したメールアドレスのみ管理画面にアクセス可能
- Supabase Authの基本認証を使用

**顧客体験**
- 会員登録不要で作品閲覧・購入が可能
- 購入時に必要最小限の情報（名前、メール、配送先）のみ収集
- 注文確認はメールで送信

**セキュリティ**
- 行レベルセキュリティ（RLS）で管理者のみ編集可能に設定
- 公開コンテンツは全ユーザーが閲覧可能

### **アート画像の保存と管理戦略**

Supabase Storageは1GBの無料ストレージを提供しています。Next.jsアプリで表示するために、画像をSupabase Storageにアップロードし、公開URLを取得する方法を検討します。画像をバケット（作品ごと、ユーザーごとなど）に整理し、必要に応じてストレージバケットのセキュリティルールでアクセスを制御します。

Supabaseの無料利用枠の制限（データベース500MB、ストレージ1GB、月間アクティブユーザー5万人）は、個人プロジェクトにとっては驚くほど高く、これにより「最小限のサーバーコスト」という要件をバックエンドに関して十分に満たしながら、長期間コストをかけずに運営できる可能性が高まります。

また、Supabase StudioのビジュアルスキーマデザイナーやSQLエディタといった機能は、SQLに不慣れな開発者にとってもデータベース管理のハードルを下げ、開発者の生産性を向上させます。

## **Netlifyでのデプロイ：Next.js 15対応とOpenNext**

### **Netlifyの選択理由と最新対応**

個人アーティストの作品販売サイトには、商用利用が可能なNetlifyが最適です：

- **商用利用**: 無料プランでも作品販売が可能
- **Next.js 15対応**: OpenNext adapter使用で完全サポート
- **寛大な制限**: 月間100GB帯域幅、300分ビルド時間
- **優れた機能**: 自動デプロイ、プレビュー、エッジファンクション

### **OpenNext Adapter導入**

Next.js 15をNetlifyで動作させるため、OpenNext adapterを使用：

```bash
npm install @opennextjs/aws
```

`next.config.ts`での設定：
```typescript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Netlify用の設定
  output: 'export', // 静的エクスポート
  trailingSlash: true,
  images: {
    unoptimized: true, // Netlify Image CDN使用時
  },
}

module.exports = nextConfig
```

### **Netlify Image CDNとの連携**

Supabase StorageとNetlify Image CDNを組み合わせ：
- Supabase Storage: 画像の元ファイル保存
- Netlify Image CDN: リサイズ・最適化配信
- Next.js 15 Image: 自動最適化と遅延読み込み

### **シームレスなGitHub連携**

NetlifyはGitHubリポジトリと直接連携し、継続的デプロイを実現します。メインブランチへのプッシュは本番環境へのデプロイをトリガーし、他のブランチへのプッシュはプレビューデプロイを作成できます。

### **環境変数の管理**

SupabaseのURL/anonキー、Stripeのキー、管理者メールアドレス等を安全に保存するために環境変数の管理は不可欠です。Netlifyのダッシュボードは、これらの変数を本番、プレビュー、開発といった異なる環境ごとに安全に管理する方法を提供します。

### **Netlifyの追加機能活用**

- **フォーム処理**: お問い合わせフォームの簡単実装
- **分析**: 訪問者データの基本的な分析
- **Edge Functions**: Next.js 15ミドルウェアの処理拡張

---

## **更新履歴**

- 2025/06/11: Next.js 15 + React 19対応、OpenNext adapter情報追加、最新のアーキテクチャ情報を反映
